<!DOCTYPE html>
<html lang="en">
<head>
    <script src="js/CSInterface.js"></script>
    <title>AutoSlot app</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        iframe {
            width: 100%;
            height: 100vh;
            border: none;
            display: block;
        }
    </style>
</head>
<body>
<iframe id="myIframe" src="<REPLACE TO YOUR DOMAIN>" scrolling="yes"></iframe>

<script>
    const csInterface = new CSInterface();

    window.addEventListener("message", (event) => {

        if (event.data.jsx) {
            csInterface.evalScript(event.data.jsx);
            return;
        }

        if(event.data.openUrl){

            csInterface.evalScript(`openPage(${event.data.openUrl})`);
            return;
        }

        const { script, requestId } = event.data;

        if (script) {
            evalScriptAsync(script)
                .then((response) => {
                    const iframe = document.getElementById("myIframe");
                    iframe.contentWindow.postMessage({response,requestId}, "*");
                })
                .catch((error) => {
                    const iframe = document.getElementById("myIframe");
                    iframe.contentWindow.postMessage({
                        response: `Ошибка: ${error}`,
                        requestId: requestId
                    }, "*");
                });
        }
    });

    function evalScriptAsync(script) {
        return new Promise((resolve, reject) => {
            const csInterface = new CSInterface();
            csInterface.evalScript(script, (result) => {
                if (result) {
                    resolve(result);
                } else {
                    reject('Ошибка: нет результата');
                }
            });
        });
    }
</script>
</body>
</html>
